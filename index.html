<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏ñ‡∏ñ‡∏∂‡∏á‡∏ö‡πâ‡∏≤‡∏ô - Delivery Car Wash</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .card { border-radius: 15px; border: none; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .btn-primary { background-color: #1a5d1a; border: none; }
        .btn-primary:hover { background-color: #144514; }
        .car-item { background: #fff; border-left: 5px solid #1a5d1a; margin-bottom: 10px; padding: 10px; border-radius: 5px; }
        .price-tag { font-size: 1.2rem; font-weight: bold; color: #1a5d1a; }
    </style>
</head>
<body>

<div class="container py-4">
    <div class="text-center mb-4">
        <h2 class="fw-bold">‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏ñ‡∏ñ‡∏∂‡∏á‡∏ö‡πâ‡∏≤‡∏ô üßº</h2>
        <p class="text-muted">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏£‡∏ñ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏°‡∏ñ‡∏∂‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∏‡∏ì</p>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card p-4 mb-4">
                <h5 class="mb-3">1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á</h5>
                <div class="mb-3">
                    <label class="form-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                    <input type="tel" id="phone" class="form-control" placeholder="08XXXXXXXX" required>
                </div>
                <div class="mb-3">
                    <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                    <input type="text" id="custName" class="form-control" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
                </div>
                <div class="mb-3">
                    <label class="form-label">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà / ‡∏à‡∏∏‡∏î‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï</label>
                    <textarea id="address" class="form-control" rows="2" placeholder="‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà, ‡∏ã‡∏≠‡∏¢, ‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô"></textarea>
                </div>
                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="getLocation()">üìç ‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</button>
                <input type="hidden" id="mapUrl">
            </div>

            <div class="card p-4 mb-4">
                <h5 class="mb-3">2. ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏£‡∏ñ</h5>
                <div class="row g-2">
                    <div class="col-6">
                        <label class="form-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏ñ</label>
                        <select id="vType" class="form-select" onchange="updatePriceOptions()">
                            <option value="car">‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option>
                            <option value="bigCar">‡∏£‡∏ñ‡πÉ‡∏´‡∏ç‡πà (6 ‡∏•‡πâ‡∏≠+)</option>
                            <option value="bike">‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÑ‡∏ã‡∏Ñ‡πå</option>
                            <option value="bigBike">Big Bike (300cc+)</option>
                        </select>
                    </div>
                    <div class="col-6">
                        <label class="form-label">‡∏Ç‡∏ô‡∏≤‡∏î/‡∏£‡∏∏‡πà‡∏ô</label>
                        <select id="vSize" class="form-select" onchange="calculateCurrentPrice()">
                            </select>
                    </div>
                </div>

                <div class="mt-3">
                    <label class="form-label">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏û‡πá‡∏Ñ‡πÄ‡∏Å‡∏à</label>
                    <div id="packageArea">
                        </div>
                </div>

                <div class="form-check mt-3" id="evOption" style="display:none;">
                    <input class="form-check-input" type="checkbox" id="isEV" onchange="calculateCurrentPrice()">
                    <label class="form-check-label">‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå EV (+100 ‡∏ö‡∏≤‡∏ó)</label>
                </div>
                <div class="form-check mt-3" id="chainOption" style="display:none;">
                  <input class="form-check-input" type="checkbox" id="isChainClean" onchange="calculateCurrentPrice()">
                  <label class="form-check-label">‡∏•‡πâ‡∏≤‡∏á‡πÇ‡∏ã‡πà + ‡πÄ‡∏Ñ‡∏•‡∏∑‡∏≠‡∏ö (+120 ‡∏ö‡∏≤‡∏ó)</label>
                </div>
              
              <div class="row mt-3">
                  <div class="col-6">
                      <label class="form-label">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç (‡∏ö‡∏≤‡∏ó)</label>
                      <input type="number" id="manualPrice" class="form-control" oninput="calculateCurrentPrice()" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô">
                  </div>
                  <div class="col-6">
                      <label class="form-label">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (‡∏ö‡∏≤‡∏ó)</label>
                      <input type="number" id="individualDiscount" class="form-control" oninput="calculateCurrentPrice()" value="0">
                  </div>
              </div>

                <div class="mt-4 p-3 bg-light rounded text-center">
                    <span class="text-muted">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ñ‡∏±‡∏ô‡∏ô‡∏µ‡πâ:</span>
                    <span id="currentPriceDisplay" class="price-tag">0</span> ‡∏ø
                    <button type="button" class="btn btn-primary d-block w-100 mt-2" onclick="addCar()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</button>
                </div>
            </div>

            <div class="card p-4 mb-4">
                <h5 class="mb-3">3. ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</h5>
                <div id="carList">
                    <p class="text-muted text-center">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏ñ</p>
                </div>
                <hr>
                <div class="mb-3">
                    <label class="form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏∞‡∏î‡∏ß‡∏Å</label>
                    <input type="datetime-local" id="appointTime" class="form-control">
                </div>
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <span class="fw-bold">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥:</span>
                        <span id="totalPrice" class="price-tag">0</span> ‡∏ø
                    </div>
                    <button class="btn btn-success btn-lg" onclick="submitBooking()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß</button>
                </div>
                <small class="text-danger mt-2 d-block">* ‡∏ü‡∏£‡∏µ‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á 18 ‡∏Å‡∏°. ‡πÅ‡∏£‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏±‡∏á‡∏™‡∏¥‡∏ï</small>
            </div>
        </div>
    </div>
</div>

<script>
  let cart = [];
  const defaultPrices = {
      car: { S: 350, M: 450, L: 550 },
      bigCar: { '6 ‡∏•‡πâ‡∏≠‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ': 600 },
      bike: { '‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ': 200 },
      bigBike: { '300cc+': 300 }
  };

  function getLocation() {
      if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(pos) {
              const lat = pos.coords.latitude;
              const lng = pos.coords.longitude;
              // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏¥‡∏î‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß ($lat)
              document.getElementById('mapUrl').value = `https://www.google.com/maps?q=${lat},${lng}`;
              alert("üìç ‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
          }, function(error) {
              alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î GPS");
          });
      }
  }

  function updatePriceOptions() {
      const type = document.getElementById('vType').value;
      const sizeSelect = document.getElementById('vSize');
      const evOpt = document.getElementById('evOption');
      const chainOpt = document.getElementById('chainOption');

      sizeSelect.innerHTML = '';
      if (type === 'car') {
          sizeSelect.innerHTML = `<option value="S">S (Yaris, City)</option><option value="M">M (Civic, Altis)</option><option value="L">L (SUV, ‡∏Å‡∏£‡∏∞‡∏ö‡∏∞)</option>`;
          evOpt.style.display = 'block';
          chainOpt.style.display = 'none';
      } else {
          const label = type === 'bike' ? '‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ' : (type === 'bigBike' ? '300cc+' : '6 ‡∏•‡πâ‡∏≠‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ');
          sizeSelect.innerHTML = `<option value="${label}">${label}</option>`;
          evOpt.style.display = 'none';
          chainOpt.style.display = (type === 'bike' || type === 'bigBike') ? 'block' : 'none';
      }
      setBasePrice();
  }

  function setBasePrice() {
      const type = document.getElementById('vType').value;
      const size = document.getElementById('vSize').value;
      document.getElementById('manualPrice').value = defaultPrices[type][size] || 0;
      calculateCurrentPrice();
  }

  function calculateCurrentPrice() {
      const type = document.getElementById('vType').value;
      let basePrice = parseInt(document.getElementById('manualPrice').value) || 0;
      let discount = parseInt(document.getElementById('individualDiscount').value) || 0;
      let extra = 0;

      if (type === 'car' && document.getElementById('isEV').checked) extra += 100;
      // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ checkbox ‡πÉ‡∏´‡πâ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô
      const chainClean = document.getElementById('isChainClean');
      if (chainClean && chainClean.checked) extra += 120;

      let finalPrice = (basePrice + extra) - discount;
      document.getElementById('currentPriceDisplay').innerText = finalPrice < 0 ? 0 : finalPrice;
  }

  function addCar() {
      const typeSelect = document.getElementById('vType');
      const chainClean = document.getElementById('isChainClean');
      const isEV = document.getElementById('isEV');
      
      const car = {
          typeName: typeSelect.options[typeSelect.selectedIndex].text,
          size: document.getElementById('vSize').value,
          basePrice: document.getElementById('manualPrice').value,
          // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡∏û‡∏±‡∏á‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
          addon: (chainClean && chainClean.checked) ? "‡∏•‡πâ‡∏≤‡∏á‡πÇ‡∏ã‡πà" : (isEV && isEV.checked ? "EV" : "-"),
          discount: document.getElementById('individualDiscount').value,
          price: parseInt(document.getElementById('currentPriceDisplay').innerText)
      };
      cart.push(car);
      renderCart();
      
      document.getElementById('individualDiscount').value = 0;
      if(chainClean) chainClean.checked = false;
      if(isEV) isEV.checked = false;
  }

  function renderCart() {
      const list = document.getElementById('carList');
      list.innerHTML = '';
      let total = 0;
      cart.forEach((item, index) => {
          total += item.price;
          list.innerHTML += `<div class="car-item d-flex justify-content-between align-items-center mb-2">
              <div><b>${item.typeName} (${item.size})</b><br><small>‡∏£‡∏≤‡∏Ñ‡∏≤ ${item.price} ‡∏ø</small></div>
              <button class="btn btn-sm btn-danger" onclick="cart.splice(${index},1); renderCart();">‡∏•‡∏ö</button>
          </div>`;
      });
      
      let finalTotal = total;
      if (cart.length >= 10) finalTotal *= 0.85;
      else if (cart.length >= 5) finalTotal *= 0.90;
      document.getElementById('totalPrice').innerText = Math.round(finalTotal);
  }

  async function submitBooking() {
    // 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL: ‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏á‡∏ó‡πâ‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢ /exec ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzov8J1aC3-Pv-6trRUD-7Ll5rk6yyOxN5RyEXmWH7ozetseXQfXxBPx_Q-egpX6Krv/exec"; 
    
    if (cart.length === 0) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏ñ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏Ñ‡∏±‡∏ô");

    const data = {
        customerName: document.getElementById('custName').value,
        phone: document.getElementById('phone').value,
        address: document.getElementById('address').value,
        mapUrl: document.getElementById('mapUrl').value,
        appointment: document.getElementById('appointTime').value,
        cars: cart
    };

    try {
        const btn = document.querySelector("button[onclick='submitBooking()']");
        btn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å..."; btn.disabled = true;

        // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ: ‡πÉ‡∏ä‡πâ no-cors ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡πÅ‡∏ö‡∏ö text/plain
        await fetch(WEB_APP_URL, { 
            method: 'POST', 
            mode: 'no-cors', 
            cache: 'no-cache',
            headers: { 'Content-Type': 'text/plain' },
            body: JSON.stringify(data) 
        });

        // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ no-cors ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏ä‡πá‡∏Å Success ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ 
        // ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡πÇ‡∏Ñ‡πâ‡∏î‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î‡πÑ‡∏õ‡∏ó‡∏µ‡πà catch ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß
        alert("‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ä‡πá‡∏Å‡∏ó‡∏µ‡πà Google Sheet");
        location.reload();

    } catch (e) {
        alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠: " + e.message);
        const btn = document.querySelector("button[onclick='submitBooking()']");
        btn.innerText = "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß"; btn.disabled = false;
    }
}

  window.onload = updatePriceOptions;
</script>
</body>
</html>