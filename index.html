<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏ñ‡∏ñ‡∏∂‡∏á‡∏ö‡πâ‡∏≤‡∏ô - Delivery Car Wash</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .card { border-radius: 15px; border: none; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .btn-primary { background-color: #1a5d1a; border: none; }
        .btn-primary:hover { background-color: #144514; }
        .car-item { background: #fff; border-left: 5px solid #1a5d1a; margin-bottom: 10px; padding: 10px; border-radius: 5px; }
        .price-tag { font-size: 1.2rem; font-weight: bold; color: #1a5d1a; }
    </style>
</head>
<body>

<div class="container py-4">
    <div class="text-center mb-4">
        <h2 class="fw-bold">‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏ñ‡∏ñ‡∏∂‡∏á‡∏ö‡πâ‡∏≤‡∏ô üßº</h2>
        <p class="text-muted">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏£‡∏ñ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏°‡∏ñ‡∏∂‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∏‡∏ì</p>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card p-4 mb-4">
                <h5 class="mb-3">1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á</h5>
                <div class="mb-3">
                    <label class="form-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                    <input type="tel" id="phone" class="form-control" placeholder="08XXXXXXXX" required>
                </div>
                <div class="mb-3">
                    <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                    <input type="text" id="custName" class="form-control" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
                </div>
                <div class="mb-3">
                    <label class="form-label">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà / ‡∏à‡∏∏‡∏î‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï</label>
                    <textarea id="address" class="form-control" rows="2" placeholder="‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà, ‡∏ã‡∏≠‡∏¢, ‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô"></textarea>
                </div>
                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="getLocation()">üìç ‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</button>
                <input type="hidden" id="mapUrl">
            </div>

            <div class="card p-4 mb-4">
                <h5 class="mb-3">2. ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏£‡∏ñ</h5>
                <div class="row g-2">
                    <div class="col-6">
                        <label class="form-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏ñ</label>
                        <select id="vType" class="form-select" onchange="updatePriceOptions()">
                            <option value="car">‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option>
                            <option value="bigCar">‡∏£‡∏ñ‡πÉ‡∏´‡∏ç‡πà (6 ‡∏•‡πâ‡∏≠+)</option>
                            <option value="bike">‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÑ‡∏ã‡∏Ñ‡πå</option>
                            <option value="bigBike">Big Bike (300cc+)</option>
                        </select>
                    </div>
                    <div class="col-6">
                        <label class="form-label">‡∏Ç‡∏ô‡∏≤‡∏î/‡∏£‡∏∏‡πà‡∏ô</label>
                        <select id="vSize" class="form-select" onchange="calculateCurrentPrice()">
                            </select>
                    </div>
                </div>

                <div class="mt-3">
                    <label class="form-label">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏û‡πá‡∏Ñ‡πÄ‡∏Å‡∏à</label>
                    <div id="packageArea">
                        </div>
                </div>

                <div class="form-check mt-3" id="evOption" style="display:none;">
                    <input class="form-check-input" type="checkbox" id="isEV" onchange="calculateCurrentPrice()">
                    <label class="form-check-label">‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå EV (+100 ‡∏ö‡∏≤‡∏ó)</label>
                </div>

                <div class="mt-4 p-3 bg-light rounded text-center">
                    <span class="text-muted">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ñ‡∏±‡∏ô‡∏ô‡∏µ‡πâ:</span>
                    <span id="currentPriceDisplay" class="price-tag">0</span> ‡∏ø
                    <button type="button" class="btn btn-primary d-block w-100 mt-2" onclick="addCar()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</button>
                </div>
            </div>

            <div class="card p-4 mb-4">
                <h5 class="mb-3">3. ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</h5>
                <div id="carList">
                    <p class="text-muted text-center">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏ñ</p>
                </div>
                <hr>
                <div class="mb-3">
                    <label class="form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏∞‡∏î‡∏ß‡∏Å</label>
                    <input type="datetime-local" id="appointTime" class="form-control">
                </div>
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <span class="fw-bold">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥:</span>
                        <span id="totalPrice" class="price-tag">0</span> ‡∏ø
                    </div>
                    <button class="btn btn-success btn-lg" onclick="submitBooking()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß</button>
                </div>
                <small class="text-danger mt-2 d-block">* ‡∏ü‡∏£‡∏µ‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á 18 ‡∏Å‡∏°. ‡πÅ‡∏£‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏±‡∏á‡∏™‡∏¥‡∏ï</small>
            </div>
        </div>
    </div>
</div>

<script>
    let cart = [];
    const priceData = {
        car: {
            sizes: { 'S': 'S (Yaris, City)', 'M': 'M (Civic, Altis)', 'L': 'L (SUV, ‡∏Å‡∏£‡∏∞‡∏ö‡∏∞)' },
            packages: [
                { name: '‡∏•‡πâ‡∏≤‡∏á+‡∏î‡∏π‡∏î‡∏ù‡∏∏‡πà‡∏ô+‡πÄ‡∏ä‡πá‡∏î‡πÅ‡∏´‡πâ‡∏á', prices: { S: 350, M: 450, L: 550 } },
                { name: '‡∏•‡πâ‡∏≤‡∏á+‡∏î‡∏π‡∏î‡∏ù‡∏∏‡πà‡∏ô+‡πÄ‡∏Ñ‡∏•‡∏∑‡∏≠‡∏ö‡πÄ‡∏á‡∏≤', prices: { S: 450, M: 550, L: 650 } }
            ]
        },
        bike: {
            sizes: { '‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ': '‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÑ‡∏ã‡∏Ñ‡πå‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ' },
            packages: [{ name: '‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏Å‡∏ï‡∏¥', prices: { '‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ': 200 } }]
        }
    };

    function updatePriceOptions() {
        const type = document.getElementById('vType').value;
        const sizeSelect = document.getElementById('vSize');
        const pkgArea = document.getElementById('packageArea');
        const evOpt = document.getElementById('evOption');

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡∏ô‡∏≤‡∏î‡∏£‡∏ñ
        sizeSelect.innerHTML = '';
        const sizes = type === 'car' ? priceData.car.sizes : { 'std': '‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô' };
        for (let k in sizes) {
            sizeSelect.innerHTML += `<option value="${k}">${sizes[k]}</option>`;
        }

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏û‡πá‡∏Ñ‡πÄ‡∏Å‡∏à (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏¢‡πà‡∏≠)
        pkgArea.innerHTML = type === 'car' ? 
            `<select id="pkg" class="form-select" onchange="calculateCurrentPrice()">
                <option value="350">‡∏•‡πâ‡∏≤‡∏á+‡∏î‡∏π‡∏î‡∏ù‡∏∏‡πà‡∏ô+‡πÄ‡∏ä‡πá‡∏î‡πÅ‡∏´‡πâ‡∏á</option>
                <option value="450">‡∏•‡πâ‡∏≤‡∏á+‡∏î‡∏π‡∏î‡∏ù‡∏∏‡πà‡∏ô+‡πÄ‡∏Ñ‡∏•‡∏∑‡∏≠‡∏ö‡πÄ‡∏á‡∏≤</option>
            </select>` : 
            `<input type="text" class="form-control" value="‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î" readonly>`;
        
        evOpt.style.display = type === 'car' ? 'block' : 'none';
        calculateCurrentPrice();
    }

    function calculateCurrentPrice() {
        const type = document.getElementById('vType').value;
        const size = document.getElementById('vSize').value;
        let price = 0;

        if (type === 'car') {
            const base = parseInt(document.getElementById('pkg').value);
            const sizeAdd = size === 'M' ? 100 : (size === 'L' ? 200 : 0);
            price = base + sizeAdd;
            if (document.getElementById('isEV').checked) price += 100;
        } else {
            price = type === 'bike' ? 200 : 400;
        }

        document.getElementById('currentPriceDisplay').innerText = price;
    }

    function addCar() {
        const car = {
            type: document.getElementById('vType').value,
            size: document.getElementById('vSize').value,
            price: parseInt(document.getElementById('currentPriceDisplay').innerText)
        };
        cart.push(car);
        renderCart();
    }

    function renderCart() {
        const list = document.getElementById('carList');
        list.innerHTML = '';
        let total = 0;
        cart.forEach((item, index) => {
            total += item.price;
            list.innerHTML += `
                <div class="car-item d-flex justify-content-between align-items-center">
                    <div><b>${item.type} (${item.size})</b> - ${item.price} ‡∏ø</div>
                    <button class="btn btn-sm btn-danger" onclick="cart.splice(${index},1); renderCart();">‡∏•‡∏ö</button>
                </div>`;
        });
        
        // Promotion Logic
        if (cart.length >= 10) total *= 0.85;
        else if (cart.length >= 5) total *= 0.90;

        document.getElementById('totalPrice').innerText = Math.round(total);
    }

    function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(pos => {
                document.getElementById('mapUrl').value = `https://www.google.com/maps?q=${pos.coords.latitude},${pos.coords.longitude}`;
                alert("‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
            });
        }
    }

    async function submitBooking() {
    // ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢ URL ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏ï‡∏≠‡∏ô‡∏Å‡∏î Deploy ‡πÉ‡∏ô Google Apps Script
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbz74EOmoVL3NLCZpVc6lx68cy8ATpulBW05TU3Iu0x0OvNTozzO4BoizVLe6ktmkFe0/exec"; 

    const data = {
        customerName: document.getElementById('custName').value,
        phone: document.getElementById('phone').value,
        address: document.getElementById('address').value,
        mapUrl: document.getElementById('mapUrl').value,
        appointment: document.getElementById('appointTime').value,
        cars: cart
    };

    if (cart.length === 0) {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏ñ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏Ñ‡∏±‡∏ô");
        return;
    }

    try {
        // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡∏ã‡πâ‡∏≥
        const btn = document.querySelector("button[onclick='submitBooking()']");
        btn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...";
        btn.disabled = true;

        const response = await fetch(WEB_APP_URL, {
            method: 'POST',
            mode: 'no-cors', // ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≤‡∏° Domain ‡πÑ‡∏õ Google ‡πÑ‡∏î‡πâ
            cache: 'no-cache',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });

        alert("‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏±‡∏ö");
        location.reload(); // ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà

    } catch (error) {
        console.error(error);
        alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ó‡∏≤‡∏á Line");
    }
}

    updatePriceOptions();
</script>

</body>
</html>